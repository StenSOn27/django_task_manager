{% extends "base.html" %}
{% load crispy_forms_filters %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/task_styles.css' %}" />
        <!-- Page Content -->
        <div style="flex: 1; padding: 24px; overflow: hidden; display: flex; flex-direction: column;">
            
            <!-- Page Title -->
            <div style="margin-bottom: 20px;">
                <h1 style="margin: 0; font-size: 24px; font-weight: 600; color: #1f2937; display: flex; align-items: center; gap: 12px;">
                    <div style="width: 32px; height: 32px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                        <i class="fas fa-plus" style="font-size: 14px;"></i>
                    </div>
                    {{ object|yesno:"Edit task,Create task" }}
                </h1>
            </div>
            
            <!-- Form Errors -->
            {% if form.errors %}
            <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <i class="fas fa-exclamation-triangle" style="color: #ef4444; font-size: 16px;"></i>
                    <h3 style="margin: 0; color: #dc2626; font-size: 16px; font-weight: 600;">Form contains errors</h3>
                </div>
                <p style="margin: 0; color: #dc2626; font-size: 14px;">Please fix the following errors and try again:</p>
                <ul style="margin: 8px 0 0 0; padding-left: 20px; color: #dc2626; font-size: 14px;">
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <li>{{ field|title }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <!-- Form -->
            <form method="post" action="" novalidate style="flex: 1; display: flex; flex-direction: column; gap: 20px;">
                {% csrf_token %}
                
                <!-- Row 1: Name, Priority, Task Type -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 24px;">
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="{{ form.name.id_for_label }}" style="font-size: 14px; font-weight: 500; color: #374151; display: flex; align-items: center; gap: 6px;">
                            <i class="fas fa-tag" style="color: #6b7280; font-size: 12px;"></i>
                            Name
                            <span style="color: #ef4444; font-size: 14px;">*</span>
                        </label>
                        {{ form.name }}
                        {% if form.name.errors %}
                            <div style="color: #ef4444; font-size: 12px; margin-top: 4px;">
                                {% for error in form.name.errors %}
                                    <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="{{ form.priority.id_for_label }}" style="font-size: 14px; font-weight: 500; color: #374151; display: flex; align-items: center; gap: 6px;">
                            <i class="fas fa-flag" style="color: #6b7280; font-size: 12px;"></i>
                            Priority
                            <span style="color: #ef4444; font-size: 14px;">*</span>
                        </label>
                        {{ form.priority }}
                        {% if form.priority.errors %}
                            <div style="color: #ef4444; font-size: 12px; margin-top: 4px;">
                                {% for error in form.priority.errors %}
                                    <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="{{ form.task_type.id_for_label }}" style="font-size: 14px; font-weight: 500; color: #374151; display: flex; align-items: center; gap: 6px;">
                            <i class="fas fa-layer-group" style="color: #6b7280; font-size: 12px;"></i>
                            Task type
                            <span style="color: #ef4444; font-size: 14px;">*</span>
                        </label>
                        {{ form.task_type }}
                        {% if form.task_type.errors %}
                            <div style="color: #ef4444; font-size: 12px; margin-top: 4px;">
                                {% for error in form.task_type.errors %}
                                    <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Row 2: Description and Assignees -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; flex: 1;">
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="{{ form.description.id_for_label }}" style="font-size: 14px; font-weight: 500; color: #374151; display: flex; align-items: center; gap: 6px;">
                            <i class="fas fa-align-left" style="color: #6b7280; font-size: 12px;"></i>
                            Description
                        </label>
                        {{ form.description }}
                        {% if form.description.errors %}
                            <div style="color: #ef4444; font-size: 12px; margin-top: 4px;">
                                {% for error in form.description.errors %}
                                    <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="font-size: 14px; font-weight: 500; color: #374151; display: flex; align-items: center; gap: 6px;">
                            <i class="fas fa-users" style="color: #6b7280; font-size: 12px;"></i>
                            Assignees
                            <span style="color: #ef4444; font-size: 14px;">*</span>
                        </label>
                        <div style="border: 1px solid #d1d5db; border-radius: 8px; padding: 16px; background: white; height: 320px; overflow-y: auto;">
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                {% for choice in form.assignees %}
                                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; padding: 10px; border-radius: 6px; transition: background-color 0.2s;">
                                    {{ choice.tag }}
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        {% with email=choice.choice_label|slice:":2"|upper %}
                                            {% if forloop.counter0|divisibleby:7 == True and forloop.counter0 != 0 %}
                                                <div style="width: 36px; height: 36px; background: #f97316; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 600;">{{ email }}</div>
                                            {% elif forloop.counter0|divisibleby:6 == True and forloop.counter0 != 0 %}
                                                <div style="width: 36px; height: 36px; background: #84cc16; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 600;">{{ email }}</div>
                                            {% elif forloop.counter0|divisibleby:5 == True and forloop.counter0 != 0 %}
                                                <div style="width: 36px; height: 36px; background: #06b6d4; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 600;">{{ email }}</div>
                                            {% elif forloop.counter0|divisibleby:4 == True and forloop.counter0 != 0 %}
                                                <div style="width: 36px; height: 36px; background: #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 600;">{{ email }}</div>
                                            {% elif forloop.counter0|divisibleby:3 == True and forloop.counter0 != 0 %}
                                                <div style="width: 36px; height: 36px; background: #8b5cf6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 600;">{{ email }}</div>
                                            {% elif forloop.counter0|divisibleby:2 == True and forloop.counter0 != 0 %}
                                                <div style="width: 36px; height: 36px; background: #f59e0b; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 600;">{{ email }}</div>
                                            {% elif forloop.counter0 == 1 %}
                                                <div style="width: 36px; height: 36px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 600;">{{ email }}</div>
                                            {% else %}
                                                <div style="width: 36px; height: 36px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 600;">{{ email }}</div>
                                            {% endif %}
                                        {% endwith %}
                                        <div>
                                            <div style="font-size: 15px; font-weight: 500; color: #1f2937;">{{ choice.choice_label }}</div> 
                                        </div>
                                    </div>
                                </label>
                                {% endfor %}
                            </div>
                        </div>
                        {% if form.assignees.errors %}
                            <div style="color: #ef4444; font-size: 12px; margin-top: 4px;">
                                {% for error in form.assignees.errors %}
                                    <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Row 3: Deadline -->
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 24px;">
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="{{ form.deadline.id_for_label }}" style="font-size: 14px; font-weight: 500; color: #374151; display: flex; align-items: center; gap: 6px;">
                            <i class="fas fa-clock" style="color: #6b7280; font-size: 12px;"></i>
                            Deadline
                        </label>
                        {{ form.deadline }}
                        {% if form.deadline.errors %}
                            <div style="color: #ef4444; font-size: 12px; margin-top: 4px;">
                                {% for error in form.deadline.errors %}
                                    <div>{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    <div></div> <!-- Empty space -->
                </div>
                
                <!-- Form Actions -->
                <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 16px; border-top: 1px solid #e5e7eb; margin-top: auto;">
                    <a href="{% url 'manager:task-list' %}" style="background: white; color: #6b7280; border: 1px solid #d1d5db; padding: 14px 28px; border-radius: 6px; font-size: 15px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s; text-decoration: none;">
                        <i class="fas fa-times" style="font-size: 13px;"></i>
                        Cancel
                    </a>
                    <button type="reset" style="background: white; color: #6b7280; border: 1px solid #d1d5db; padding: 14px 28px; border-radius: 6px; font-size: 15px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s;">
                        <i class="fas fa-redo" style="font-size: 13px;"></i>
                        Reset
                    </button>
                    <button type="submit" style="background: #3b82f6; color: white; border: none; padding: 14px 32px; border-radius: 6px; font-size: 15px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s;">
                        <i class="fas fa-check" style="font-size: 13px;"></i>
                        Submit
                    </button>
                </div>
            </form>
{% endblock %}
